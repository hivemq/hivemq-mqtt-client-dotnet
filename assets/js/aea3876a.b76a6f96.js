"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[3121],{8278:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>r});const s=JSON.parse('{"id":"how-to/set-lwt","title":"How to set a Last Will & Testament","description":"The Last Will and Testament support of MQTT can be used to notify subscribers that your client is offline.","source":"@site/docs/how-to/set-lwt.md","sourceDirName":"how-to","slug":"/how-to/set-lwt","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/set-lwt","draft":false,"unlisted":false,"editUrl":"https://github.com/hivemq/hivemq-mqtt-client-dotnet/tree/main/Documentation/docs/how-to/set-lwt.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"How to Debug","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/debug"},"next":{"title":"Wait on an Event","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/wait-on-event"}}');var i=n(4848),l=n(8453);const a={},o="How to set a Last Will & Testament",c={},r=[{value:"Using LastWillAndTestament",id:"using-lastwillandtestament",level:2},{value:"The LastWillAndTestament Builder Class",id:"the-lastwillandtestament-builder-class",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"how-to-set-a-last-will--testament",children:"How to set a Last Will & Testament"})}),"\n",(0,i.jsx)(t.p,{children:"The Last Will and Testament support of MQTT can be used to notify subscribers that your client is offline."}),"\n",(0,i.jsxs)(t.p,{children:["For a more in-depth explanation, see ",(0,i.jsx)(t.a,{href:"https://www.hivemq.com/blog/mqtt-essentials-part-9-last-will-and-testament/",children:"What is MQTT Last Will and Testament (LWT)? \u2013 MQTT Essentials: Part 9"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"using-lastwillandtestament",children:"Using LastWillAndTestament"}),"\n",(0,i.jsxs)(t.p,{children:["This example instantiates the ",(0,i.jsx)(t.code,{children:"LastWillAndTestament"})," in the ",(0,i.jsx)(t.code,{children:"HiveMQClientOption"})," class.  This is then sent to the broker in the ",(0,i.jsx)(t.code,{children:"connect"})," operation."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'// Specify the Last Will and Testament specifics in HiveMQClientOptions\nvar options = new HiveMQClientOptions\n{\n    LastWillAndTestament = new LastWillAndTestament("custom/lastwill/topic", QualityOfService.AtLeastOnceDelivery, "last will message"),\n};\n\n// Optionally set extended properties on the Last Will and Testament message\noptions.LastWillAndTestament.WillDelayInterval = 1;\noptions.LastWillAndTestament.PayloadFormatIndicator = 1;\noptions.LastWillAndTestament.MessageExpiryInterval = 100;\noptions.LastWillAndTestament.ContentType = "application/text";\noptions.LastWillAndTestament.ResponseTopic = "response/topic";\noptions.LastWillAndTestament.CorrelationData = new byte[] { 1, 2, 3, 4, 5 };\noptions.LastWillAndTestament.UserProperties.Add("userPropertyKey", "userPropertyValue");\n\n// ConnectAsync will transmit the Last Will and Testament configuration.\nvar client = new HiveMQClient(options);\nconnectResult = await client.ConnectAsync().ConfigureAwait(false);\n\n// The Last Will and Testament message will be sent to the "custom/lastwill/topic" topic if your clients get\n// unexpectedly disconnected or alternatively, if your client disconnects with `DisconnectWithWillMessage`\nvar disconnectOptions = new DisconnectOptions { ReasonCode = DisconnectReasonCode.DisconnectWithWillMessage };\nvar disconnectResult = await client.DisconnectAsync(disconnectOptions).ConfigureAwait(false);\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Because the client above disconnected with ",(0,i.jsx)(t.code,{children:"DisconnectReasonCode.DisconnectWithWillMessage"}),", subscribers to the ",(0,i.jsx)(t.code,{children:"last/will"})," topic will receive the Last Will and Testament message as specified above."]}),"\n",(0,i.jsx)(t.h2,{id:"the-lastwillandtestament-builder-class",children:"The LastWillAndTestament Builder Class"}),"\n",(0,i.jsxs)(t.p,{children:["As an ease-of-use alternative, the HiveMQtt client offers a ",(0,i.jsx)(t.code,{children:"LastWillAndTestamentBuilder"})," class to more easily instantiate a ",(0,i.jsx)(t.code,{children:"LastWillAndTestament"})," class."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'var lwt = new LastWillAndTestamentBuilder()\n            .WithTopic("last/will")\n            .WithPayload("last will message")\n            .WithQualityOfServiceLevel(QualityOfService.AtLeastOnceDelivery)\n            .WithContentType("application/text")\n            .WithResponseTopic("response/topic")\n            .WithCorrelationData(new byte[] { 1, 2, 3, 4, 5 })\n            .WithPayloadFormatIndicator(MQTT5PayloadFormatIndicator.UTF8Encoded)\n            .WithMessageExpiryInterval(100)\n            .WithUserProperty("userPropertyKey", "userPropertyValue")\n            .WithWillDelayInterval(1)\n            .Build();\n\n// Setup & Connect the client with LWT\nvar options = new HiveMQClientOptions\n{\n    LastWillAndTestament = lwt,\n};\n\nvar client = new HiveMQClient(options);\nconnectResult = await client.ConnectAsync().ConfigureAwait(false);\n'})}),"\n",(0,i.jsx)(t.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://www.hivemq.com/blog/mqtt-essentials-part-9-last-will-and-testament/",children:"What is MQTT Last Will and Testament (LWT)? \u2013 MQTT Essentials: Part 9"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/hivemq/hivemq-mqtt-client-dotnet/blob/main/Source/HiveMQtt/Client/LastWillAndTestamentBuilder.cs",children:"LastWillAndTestamentBuilder.cs"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/hivemq/hivemq-mqtt-client-dotnet/blob/main/Source/HiveMQtt/Client/LastWillAndTestament.cs",children:"LastWillAndTestament.cs"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const i={},l=s.createContext(i);function a(e){const t=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(l.Provider,{value:t},e.children)}}}]);
"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[4754],{1257(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"how-to/configure-proxy","title":"Configure a Proxy Server","description":"When deploying applications in corporate environments or certain hosting providers, network traffic may be routed through a proxy server. The HiveMQ MQTT .NET client supports connecting to MQTT brokers through HTTP proxy servers.","source":"@site/docs/how-to/configure-proxy.md","sourceDirName":"how-to","slug":"/how-to/configure-proxy","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/configure-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/hivemq/hivemq-mqtt-client-dotnet/tree/main/Documentation/docs/how-to/configure-proxy.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"docsSidebar","previous":{"title":"Wait for an Event","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/wait-on-event"},"next":{"title":"Reference","permalink":"/hivemq-mqtt-client-dotnet/docs/category/reference"}}');var i=r(4848),o=r(8453);const s={sidebar_position:8},l="Configure a Proxy Server",c={},a=[{value:"Choosing a Transport: WebSocket vs TCP",id:"choosing-a-transport-websocket-vs-tcp",level:2},{value:"WebSocket Transport (Recommended)",id:"websocket-transport-recommended",level:3},{value:"TCP Transport with HTTP CONNECT",id:"tcp-transport-with-http-connect",level:3},{value:"WebSocket Proxy Configuration (Recommended)",id:"websocket-proxy-configuration-recommended",level:2},{value:"WebSocket Proxy with Authentication",id:"websocket-proxy-with-authentication",level:3},{value:"TCP Proxy Configuration (Fallback Option)",id:"tcp-proxy-configuration-fallback-option",level:2},{value:"TCP Proxy with Authentication",id:"tcp-proxy-with-authentication",level:3},{value:"TCP Proxy with TLS",id:"tcp-proxy-with-tls",level:3},{value:"Using with RawClient",id:"using-with-rawclient",level:2},{value:"Environment-Based Proxy Configuration",id:"environment-based-proxy-configuration",level:2},{value:"Using Environment Variables",id:"using-environment-variables",level:3},{value:"Using appsettings.json",id:"using-appsettingsjson",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Logging",id:"logging",level:3},{value:"Proxy Server Requirements",id:"proxy-server-requirements",level:2},{value:"See Also",id:"see-also",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"configure-a-proxy-server",children:"Configure a Proxy Server"})}),"\n",(0,i.jsx)(n.p,{children:"When deploying applications in corporate environments or certain hosting providers, network traffic may be routed through a proxy server. The HiveMQ MQTT .NET client supports connecting to MQTT brokers through HTTP proxy servers."}),"\n",(0,i.jsx)(n.admonition,{title:"Version Note",type:"info",children:(0,i.jsxs)(n.p,{children:["Proxy support for TCP connections (",(0,i.jsx)(n.code,{children:"WithProxy"}),") was added in ",(0,i.jsx)(n.strong,{children:"v0.38.0"}),". WebSocket proxy support (",(0,i.jsx)(n.code,{children:"WithWebSocketProxy"}),") has been available since earlier versions."]})}),"\n",(0,i.jsx)(n.h2,{id:"choosing-a-transport-websocket-vs-tcp",children:"Choosing a Transport: WebSocket vs TCP"}),"\n",(0,i.jsx)(n.p,{children:"The HiveMQ MQTT client supports two transport protocols, each with different proxy capabilities:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Transport"}),(0,i.jsx)(n.th,{children:"Proxy Support"}),(0,i.jsx)(n.th,{children:"Recommended"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"WebSocket"})}),(0,i.jsx)(n.td,{children:"Native, well-tested"}),(0,i.jsx)(n.td,{children:"\u2705 Preferred"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"TCP"})}),(0,i.jsx)(n.td,{children:"HTTP CONNECT tunneling"}),(0,i.jsx)(n.td,{children:"Backup option"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"websocket-transport-recommended",children:"WebSocket Transport (Recommended)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When to use:"})," WebSocket transport should be your first choice when proxy support is required."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why it's preferred:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Native proxy support through .NET's ",(0,i.jsx)(n.code,{children:"ClientWebSocket"})," implementation"]}),"\n",(0,i.jsx)(n.li,{children:"Better compatibility with enterprise proxy servers and firewalls"}),"\n",(0,i.jsx)(n.li,{children:"HTTP-based protocol that proxies are designed to handle"}),"\n",(0,i.jsx)(n.li,{children:"Works seamlessly with most proxy configurations"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tcp-transport-with-http-connect",children:"TCP Transport with HTTP CONNECT"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When to use:"})," Use TCP proxy support as a fallback when:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"WebSocket transport is not available on your broker"}),"\n",(0,i.jsx)(n.li,{children:"You have specific requirements that prevent WebSocket usage"}),"\n",(0,i.jsx)(n.li,{children:"Your infrastructure only supports raw TCP connections"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How it works:"})," The client establishes a connection to the proxy server, then sends an HTTP CONNECT request to create a tunnel to the MQTT broker. Once the tunnel is established, MQTT traffic flows through this connection as if it were a direct connection."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Client \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 HTTP Proxy  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 MQTT Broker \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                   \u2502                     \u2502\n     \u2502  HTTP CONNECT     \u2502                     \u2502\n     \u2502  broker:port      \u2502                     \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502                     \u2502\n     \u2502                   \u2502  TCP Connection     \u2502\n     \u2502                   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n     \u2502  200 OK           \u2502                     \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                     \u2502\n     \u2502                   \u2502                     \u2502\n     \u2502         MQTT Traffic (tunneled)         \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n"})}),"\n",(0,i.jsx)(n.h2,{id:"websocket-proxy-configuration-recommended",children:"WebSocket Proxy Configuration (Recommended)"}),"\n",(0,i.jsxs)(n.p,{children:["For WebSocket connections (ws:// or wss://), use the ",(0,i.jsx)(n.code,{children:"WithWebSocketProxy"})," method:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\n\n// Basic proxy without authentication\nvar options = new HiveMQClientOptionsBuilder()\n    .WithWebSocketServer("wss://broker.example.com:8884/mqtt")\n    .WithWebSocketProxy(new WebProxy("http://proxy.example.com:8080"))\n    .Build();\n\nvar client = new HiveMQClient(options);\nawait client.ConnectAsync();\n'})}),"\n",(0,i.jsx)(n.h3,{id:"websocket-proxy-with-authentication",children:"WebSocket Proxy with Authentication"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\n\nvar proxy = new WebProxy("http://proxy.example.com:8080");\nproxy.Credentials = new NetworkCredential("proxyUsername", "proxyPassword");\n\nvar options = new HiveMQClientOptionsBuilder()\n    .WithWebSocketServer("wss://broker.example.com:8884/mqtt")\n    .WithWebSocketProxy(proxy)\n    .Build();\n\nvar client = new HiveMQClient(options);\nawait client.ConnectAsync();\n'})}),"\n",(0,i.jsx)(n.h2,{id:"tcp-proxy-configuration-fallback-option",children:"TCP Proxy Configuration (Fallback Option)"}),"\n",(0,i.jsxs)(n.p,{children:["For direct TCP connections, use the ",(0,i.jsx)(n.code,{children:"WithProxy"})," method. This uses the HTTP CONNECT method to tunnel TCP traffic through the proxy."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"TCP proxy support requires a proxy server that supports the HTTP CONNECT method for TCP tunneling. Most enterprise HTTP proxies support this feature."})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\n\n// Basic proxy without authentication\nvar options = new HiveMQClientOptionsBuilder()\n    .WithBroker("broker.example.com")\n    .WithPort(1883)\n    .WithProxy(new WebProxy("http://proxy.example.com:8080"))\n    .Build();\n\nvar client = new HiveMQClient(options);\nawait client.ConnectAsync();\n'})}),"\n",(0,i.jsx)(n.h3,{id:"tcp-proxy-with-authentication",children:"TCP Proxy with Authentication"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\n\nvar proxy = new WebProxy("http://proxy.example.com:8080");\nproxy.Credentials = new NetworkCredential("proxyUsername", "proxyPassword");\n\nvar options = new HiveMQClientOptionsBuilder()\n    .WithBroker("broker.example.com")\n    .WithPort(8883)\n    .WithUseTls(true)\n    .WithProxy(proxy)\n    .Build();\n\nvar client = new HiveMQClient(options);\nawait client.ConnectAsync();\n'})}),"\n",(0,i.jsx)(n.h3,{id:"tcp-proxy-with-tls",children:"TCP Proxy with TLS"}),"\n",(0,i.jsx)(n.p,{children:"The proxy tunnel is established first, then TLS negotiation occurs through the tunnel. This means the proxy only sees encrypted traffic after the initial CONNECT handshake."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\n\nvar proxy = new WebProxy("http://proxy.example.com:8080");\n\nvar options = new HiveMQClientOptionsBuilder()\n    .WithBroker("broker.example.com")\n    .WithPort(8883)\n    .WithUseTls(true)\n    .WithProxy(proxy)\n    .Build();\n\nvar client = new HiveMQClient(options);\nawait client.ConnectAsync();\n'})}),"\n",(0,i.jsx)(n.h2,{id:"using-with-rawclient",children:"Using with RawClient"}),"\n",(0,i.jsxs)(n.p,{children:["Both ",(0,i.jsx)(n.code,{children:"HiveMQClient"})," and ",(0,i.jsx)(n.code,{children:"RawClient"})," support proxy configuration through the same options:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\n\nvar proxy = new WebProxy("http://proxy.example.com:8080");\n\nvar options = new HiveMQClientOptionsBuilder()\n    .WithBroker("broker.example.com")\n    .WithProxy(proxy)\n    .Build();\n\n// Works with both HiveMQClient and RawClient\nvar rawClient = new RawClient(options);\nawait rawClient.ConnectAsync();\n'})}),"\n",(0,i.jsx)(n.h2,{id:"environment-based-proxy-configuration",children:"Environment-Based Proxy Configuration"}),"\n",(0,i.jsx)(n.p,{children:"In production environments, avoid hardcoding proxy settings. Use environment variables or configuration files:"}),"\n",(0,i.jsx)(n.h3,{id:"using-environment-variables",children:"Using Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\n\nvar proxyUrl = Environment.GetEnvironmentVariable("HTTP_PROXY");\nvar builder = new HiveMQClientOptionsBuilder()\n    .WithBroker("broker.example.com")\n    .WithPort(1883);\n\nif (!string.IsNullOrEmpty(proxyUrl))\n{\n    var proxy = new WebProxy(proxyUrl);\n    \n    // Optional: Add credentials from environment\n    var proxyUser = Environment.GetEnvironmentVariable("PROXY_USER");\n    var proxyPass = Environment.GetEnvironmentVariable("PROXY_PASS");\n    \n    if (!string.IsNullOrEmpty(proxyUser))\n    {\n        proxy.Credentials = new NetworkCredential(proxyUser, proxyPass);\n    }\n    \n    builder.WithProxy(proxy);\n}\n\nvar options = builder.Build();\nvar client = new HiveMQClient(options);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"using-appsettingsjson",children:"Using appsettings.json"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "MqttSettings": {\n    "Broker": "broker.example.com",\n    "Port": 1883,\n    "Proxy": {\n      "Enabled": true,\n      "Url": "http://proxy.example.com:8080",\n      "Username": "",\n      "Password": ""\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing HiveMQtt.Client;\nusing Microsoft.Extensions.Configuration;\n\nvar config = new ConfigurationBuilder()\n    .AddJsonFile("appsettings.json")\n    .Build();\n\nvar mqttSettings = config.GetSection("MqttSettings");\nvar builder = new HiveMQClientOptionsBuilder()\n    .WithBroker(mqttSettings["Broker"])\n    .WithPort(int.Parse(mqttSettings["Port"]));\n\nvar proxySection = mqttSettings.GetSection("Proxy");\nif (proxySection.GetValue<bool>("Enabled"))\n{\n    var proxy = new WebProxy(proxySection["Url"]);\n    \n    var username = proxySection["Username"];\n    if (!string.IsNullOrEmpty(username))\n    {\n        proxy.Credentials = new NetworkCredential(\n            username, \n            proxySection["Password"]);\n    }\n    \n    builder.WithProxy(proxy);\n}\n\nvar options = builder.Build();\n'})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Proxy Connection Refused"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verify the proxy URL and port are correct"}),"\n",(0,i.jsx)(n.li,{children:"Check if the proxy server is running and accessible"}),"\n",(0,i.jsx)(n.li,{children:"Ensure your network allows connections to the proxy"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"HTTP 407 Proxy Authentication Required"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The proxy requires authentication"}),"\n",(0,i.jsxs)(n.li,{children:["Add credentials using ",(0,i.jsx)(n.code,{children:"proxy.Credentials = new NetworkCredential(...)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"HTTP 403 Forbidden"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The proxy may be blocking connections to the MQTT broker port"}),"\n",(0,i.jsx)(n.li,{children:"Contact your network administrator to allow the destination"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Connection Timeout"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The proxy may not support the HTTP CONNECT method"}),"\n",(0,i.jsxs)(n.li,{children:["Try using WebSocket transport with ",(0,i.jsx)(n.code,{children:"WithWebSocketProxy"})," instead"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,i.jsx)(n.p,{children:"Enable debug logging to troubleshoot proxy connection issues:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'// In your NLog.config or logging configuration\n<logger name="HiveMQtt.*" minlevel="Trace" writeTo="console" />\n'})}),"\n",(0,i.jsx)(n.h2,{id:"proxy-server-requirements",children:"Proxy Server Requirements"}),"\n",(0,i.jsx)(n.p,{children:"For TCP proxy support (HTTP CONNECT tunneling), the proxy server must:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Support the HTTP CONNECT method (RFC 7231)"}),"\n",(0,i.jsx)(n.li,{children:"Allow connections to the MQTT broker's port (typically 1883 or 8883)"}),"\n",(0,i.jsx)(n.li,{children:"Support HTTP/1.1"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Most enterprise HTTP proxies (Squid, nginx, Apache, etc.) support these requirements."}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/connecting",children:"Connecting to a Broker"})," - Basic connection setup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/security",children:"Security Best Practices"})," - TLS and authentication"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/reference/client_options_builder",children:"HiveMQClientOptionsBuilder Reference"})," - All builder methods"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/reference/client_options",children:"HiveMQClientOptions Reference"})," - All configuration options"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>l});var t=r(6540);const i={},o=t.createContext(i);function s(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);
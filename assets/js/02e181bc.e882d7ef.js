"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[5723],{5878(e,i,t){t.r(i),t.d(i,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"how-to/client-certificates","title":"Use Client Certificates","description":"X.509 client certificates provide a more secure authentication method than username/password. The broker verifies the client\'s identity using the certificate during the TLS handshake.","source":"@site/docs/how-to/client-certificates.md","sourceDirName":"how-to","slug":"/how-to/client-certificates","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/client-certificates","draft":false,"unlisted":false,"editUrl":"https://github.com/hivemq/hivemq-mqtt-client-dotnet/tree/main/Documentation/docs/how-to/client-certificates.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Set a Last Will & Testament","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/set-lwt"},"next":{"title":"Allow Invalid TLS Certificates","permalink":"/hivemq-mqtt-client-dotnet/docs/how-to/allow-invalid-certs"}}');var s=t(4848),r=t(8453);const o={sidebar_position:3},a="Use Client Certificates",c={},l=[{value:"Using X509Certificate2",id:"using-x509certificate2",level:2},{value:"Using Certificates with Passwords",id:"using-certificates-with-passwords",level:2},{value:"Using SecureString (Recommended)",id:"using-securestring-recommended",level:3},{value:"Using X509Certificate2 Directly",id:"using-x509certificate2-directly",level:3},{value:"Using String Password (Deprecated)",id:"using-string-password-deprecated",level:3},{value:"Security Tips",id:"security-tips",level:2},{value:"Using an Environment Variable for the Certificate Password",id:"using-an-environment-variable-for-the-certificate-password",level:2},{value:"Using a Configuration File for the Certificate Password",id:"using-a-configuration-file-for-the-certificate-password",level:2},{value:"Step 1: Modify appsettings.json",id:"step-1-modify-appsettingsjson",level:3},{value:"Step 2: Create a Configuration Model",id:"step-2-create-a-configuration-model",level:3},{value:"Step 3: Load Configuration in Your Application",id:"step-3-load-configuration-in-your-application",level:3},{value:"Step 4: Use the Configuration in Your Code",id:"step-4-use-the-configuration-in-your-code",level:3},{value:"Notes",id:"notes",level:3},{value:"Extended Options",id:"extended-options",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"use-client-certificates",children:"Use Client Certificates"})}),"\n",(0,s.jsx)(i.p,{children:"X.509 client certificates provide a more secure authentication method than username/password. The broker verifies the client's identity using the certificate during the TLS handshake."}),"\n",(0,s.jsx)(i.p,{children:"For more information on X.509 client certificates, see the following:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://www.hivemq.com/blog/mqtt-security-fundamentals-x509-client-certificate-authentication/",children:"X509 Client Certificate Authentication - MQTT Security Fundamentals"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://docs.hivemq.com/hivemq/latest/user-guide/howtos.html#_generate_a_pem_client_certificate_e_g_mosquitto_pub_sub",children:"How to Generate a PEM client certificate"})}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["You can add one or more client certificates to the HiveMQtt client through the ",(0,s.jsx)(i.code,{children:"HiveMQClientOptionsBuilder"})," class."]}),"\n",(0,s.jsx)(i.p,{children:"Adding certificates will cause the client to present these certificates to the broker upon TLS connection negotiation."}),"\n",(0,s.jsx)(i.h2,{id:"using-x509certificate2",children:"Using X509Certificate2"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'using HiveMQtt.Client;\nusing System.Security.Cryptography.X509Certificates;\n\n// Can pre-create a X509Certificate2 or alternatively pass a string path\n// to the certificate (see below)\nvar clientCertificate = new X509Certificate2("path/to/certificate-file-1.pem");\n\nvar options = new HiveMQClientOptionsBuilder()\n    .WithClientCertificate(clientCertificate)\n    .WithClientCertificate("path/to/certificate-file-2.pem")\n    .Build();\n\nvar client = new HiveMQClient(options);\n'})}),"\n",(0,s.jsx)(i.h2,{id:"using-certificates-with-passwords",children:"Using Certificates with Passwords"}),"\n",(0,s.jsxs)(i.p,{children:["If your certificate is protected with a password, you can use ",(0,s.jsx)(i.code,{children:"SecureString"})," for enhanced security (recommended), or pass the password directly."]}),"\n",(0,s.jsx)(i.h3,{id:"using-securestring-recommended",children:"Using SecureString (Recommended)"}),"\n",(0,s.jsxs)(i.p,{children:["For enhanced security, use ",(0,s.jsx)(i.code,{children:"SecureString"})," to prevent password exposure in memory:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'using System.Security;\nusing HiveMQtt.Client;\n\n// Create SecureString for the certificate password\nvar certPassword = new SecureString();\nforeach (char c in GetPasswordFromSecureSource())\n{\n    certPassword.AppendChar(c);\n}\ncertPassword.MakeReadOnly();\n\nvar options = new HiveMQClientOptionsBuilder()\n    .WithClientCertificate("path/to/certificate-with-password.pfx", certPassword)\n    .Build();\n\nvar client = new HiveMQClient(options);\n'})}),"\n",(0,s.jsx)(i.h3,{id:"using-x509certificate2-directly",children:"Using X509Certificate2 Directly"}),"\n",(0,s.jsxs)(i.p,{children:["You can also instantiate the ",(0,s.jsx)(i.code,{children:"X509Certificate2"})," object manually:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'using HiveMQtt.Client;\nusing System.Security.Cryptography.X509Certificates;\n\nvar clientCertificate = new X509Certificate2(\n    "path/to/certificate-with-password.pem",\n    "certificate-password");\n\nvar options = new HiveMQClientOptionsBuilder()\n    .WithClientCertificate(clientCertificate)\n    .Build();\n\nvar client = new HiveMQClient(options);\n'})}),"\n",(0,s.jsx)(i.h3,{id:"using-string-password-deprecated",children:"Using String Password (Deprecated)"}),"\n",(0,s.jsx)(i.admonition,{type:"warning",children:(0,s.jsxs)(i.p,{children:["The string password overload is deprecated. Use ",(0,s.jsx)(i.code,{children:"SecureString"})," for enhanced security."]})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'using HiveMQtt.Client;\n\n// \u26a0\ufe0f This generates a deprecation warning - use SecureString instead\nvar options = new HiveMQClientOptionsBuilder()\n    .WithClientCertificate(\n        "path/to/certificate-with-password.pem",\n        "certificate-password")\n    .Build();\n\nvar client = new HiveMQClient(options);\n'})}),"\n",(0,s.jsx)(i.h2,{id:"security-tips",children:"Security Tips"}),"\n",(0,s.jsxs)(i.p,{children:["When using ",(0,s.jsx)(i.code,{children:"X509Certificate2"})," in C# with TLS client certificates that require a password, it's important to handle and protect the certificate passwords securely. Here are some tips to manage certificate passwords safely:"]}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Avoid Hardcoding Passwords:"})," Never hardcode the certificate password directly in the source code. This can lead to security vulnerabilities, as the source code (or compiled binaries) could be accessed by unauthorized parties."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Use Configuration Files:"})," Store the password in a configuration file separate from the codebase. Ensure this file is not checked into source control (like Git) and is only accessible by the application and authorized team members."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Environment Variables:"})," Consider using environment variables to store certificate passwords. This is useful in cloud or containerized environments. Environment variables can be set at the operating system level or within the deployment environment, keeping sensitive data out of the code."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Secure Secrets Management:"})," When appropriate, utilize a secrets management tool (like Azure Key Vault, AWS Secrets Manager, or HashiCorp Vault) to store and access secrets like certificate passwords. These tools provide a secure and centralized way to manage sensitive data, with features like access control, audit logs, and automatic rotation of secrets."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Regular Updates and Rotation:"})," Regularly update and rotate certificates and passwords. This practice can limit the damage if a certificate or its password is compromised."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"using-an-environment-variable-for-the-certificate-password",children:"Using an Environment Variable for the Certificate Password"}),"\n",(0,s.jsx)(i.p,{children:"Instead of hard-coding a password, you can use an environment variable to hold the certificate password as follows:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'using System;\nusing HiveMQtt.Client.Options;\nusing System.Security.Cryptography.X509Certificates;\n\nvar certPassword = Environment.GetEnvironmentVariable("CERT_PASSWORD");\n\nif (string.IsNullOrEmpty(certPassword))\n{\n    throw new InvalidOperationException(\n        "Certificate password not found in environment variables");\n}\n\nvar options = new HiveMQClientOptionsBuilder()\n                    .WithClientCertificate(\n                        "path/to/certificate-with-password.pem",\n                        certPassword\n                    );\n\nvar client = new HiveMQttClient(options);\n'})}),"\n",(0,s.jsx)(i.h2,{id:"using-a-configuration-file-for-the-certificate-password",children:"Using a Configuration File for the Certificate Password"}),"\n",(0,s.jsx)(i.p,{children:"You can use a configuration file to store the password instead of hardcoding it into your source code. In .NET applications, this is commonly done using appsettings.json or a similar configuration file. Here's a step-by-step guide on how to implement this:"}),"\n",(0,s.jsx)(i.p,{children:"To enhance security when handling sensitive information such as a certificate password, you can use a configuration file to store the password instead of hardcoding it into your source code. In .NET applications, this is commonly done using appsettings.json or a similar configuration file. Here's a step-by-step guide on how to implement this:"}),"\n",(0,s.jsx)(i.h3,{id:"step-1-modify-appsettingsjson",children:"Step 1: Modify appsettings.json"}),"\n",(0,s.jsxs)(i.p,{children:["Add the certificate password to your ",(0,s.jsx)(i.code,{children:"appsettings.json"})," file. It's important to ensure that this file is properly secured and not included in source control (e.g., Git)."]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'{\n  // Other configuration settings\n  "CertificateSettings": {\n    "CertificatePath": "path/to/certificate-with-password.pem",\n    "CertificatePassword": "YourSecurePassword"\n  }\n}\n'})}),"\n",(0,s.jsx)(i.h3,{id:"step-2-create-a-configuration-model",children:"Step 2: Create a Configuration Model"}),"\n",(0,s.jsx)(i.p,{children:"Create a simple model to represent the settings."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:"public class CertificateSettings\n{\n    public string CertificatePath { get; set; }\n    public string CertificatePassword { get; set; }\n}\n"})}),"\n",(0,s.jsx)(i.h3,{id:"step-3-load-configuration-in-your-application",children:"Step 3: Load Configuration in Your Application"}),"\n",(0,s.jsxs)(i.p,{children:["In the part of your application where you configure services, set up code to load the settings from ",(0,s.jsx)(i.code,{children:"appsettings.json"}),"."]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:"using Microsoft.Extensions.Configuration;\nusing System.IO;\n\n// Assuming you are in the Startup.cs or a similar setup file\npublic class Startup\n{\n    public IConfiguration Configuration { get; }\n\n    public Startup(IConfiguration configuration)\n    {\n        Configuration = configuration;\n    }\n\n    // Other configurations...\n}\n"})}),"\n",(0,s.jsx)(i.h3,{id:"step-4-use-the-configuration-in-your-code",children:"Step 4: Use the Configuration in Your Code"}),"\n",(0,s.jsx)(i.p,{children:"Now, use the configuration settings when creating the HiveMQtt client options."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'// Load certificate settings\nvar certSettings = new CertificateSettings();\nConfiguration.GetSection("CertificateSettings").Bind(certSettings);\n\n// Use settings to initialize HiveMQtt client options\nvar options = new HiveMQClientOptionsBuilder()\n    .WithClientCertificate(\n        certSettings.CertificatePath,\n        certSettings.CertificatePassword)\n    .Build();\n\nvar client = new HiveMQClient(options);\n'})}),"\n",(0,s.jsx)(i.h3,{id:"notes",children:"Notes"}),"\n",(0,s.jsx)(i.p,{children:"A couple tips on the above example:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Secure ",(0,s.jsx)(i.code,{children:"appsettings.json"}),": Ensure this file is not exposed or checked into source control. Use file permissions to restrict access."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Environment-Specific Settings: For different environments (development, staging, production), use environment-specific appsettings files like ",(0,s.jsx)(i.code,{children:"appsettings.Production.json"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"extended-options",children:"Extended Options"}),"\n",(0,s.jsxs)(i.p,{children:["TLS negotiation with client certificates is based on the ",(0,s.jsx)(i.code,{children:"X509Certificate2"})," class.  See the ",(0,s.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509certificate2?view=net-8.0",children:"official\n.NET documentation"})," for more options and information."]}),"\n",(0,s.jsx)(i.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"/docs/security",children:"Security Best Practices"})," - Comprehensive security guide including SecureString usage"]}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://www.hivemq.com/blog/mqtt-security-fundamentals-x509-client-certificate-authentication/",children:"X509 Client Certificate Authentication - MQTT Security Fundamentals"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://www.hivemq.com/blog/mqtt-security-fundamentals-tls-ssl/",children:"TLS/SSL - MQTT Security Fundamentals"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://github.com/hivemq/hivemq-mqtt-client-dotnet/blob/main/Source/HiveMQtt/Client/HiveMQClientOptionsBuilder.cs",children:"HiveMQClientOptionsBuilder.cs"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://github.com/hivemq/hivemq-mqtt-client-dotnet/blob/main/Source/HiveMQtt/Client/Options/HiveMQClientOptions.cs",children:"HiveMQClientOptions.cs"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509certificate2?view=net-8.0",children:"Microsoft .NET Documentation: X.509"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,i,t){t.d(i,{R:()=>o,x:()=>a});var n=t(6540);const s={},r=n.createContext(s);function o(e){const i=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(r.Provider,{value:i},e.children)}}}]);